# Roadmap: v1.4 Observability

## Overview

Add HTTP health endpoint to the steering daemon for external monitoring and container orchestration. Two phases: core endpoint infrastructure (Phase 25), then steering state exposure and daemon integration (Phase 26).

## Phases

- [ ] **Phase 25: Health Endpoint Core** - HTTP server, routes, threading, lifecycle
- [ ] **Phase 26: Steering State & Integration** - Response content, daemon wiring

## Phase Details

### Phase 25: Health Endpoint Core

**Goal**: Steering daemon exposes a functioning HTTP health endpoint that responds with basic health status
**Depends on**: Nothing (first phase of v1.4)
**Requirements**: HLTH-01, HLTH-02, HLTH-03, HLTH-04, HLTH-05, HLTH-06
**Success Criteria** (what must be TRUE):
  1. `curl http://127.0.0.1:9102/health` returns JSON with status, uptime_seconds, version
  2. Health server runs in background thread without blocking daemon main loop
  3. Health server stops cleanly during shutdown (no orphaned threads)
  4. Returns 200 when healthy, 503 when degraded
**Plans**: 2 plans

Plans:
- [ ] 25-01-PLAN.md - Create health endpoint module with HTTP server
- [ ] 25-02-PLAN.md - Add unit tests for steering health endpoint

### Phase 26: Steering State & Integration

**Goal**: Health response includes live steering state and endpoint is wired into daemon lifecycle
**Depends on**: Phase 25 (health endpoint exists)
**Requirements**: STEER-01, STEER-02, STEER-03, STEER-04, STEER-05, INTG-01, INTG-02, INTG-03
**Success Criteria** (what must be TRUE):
  1. Health response includes current steering decision (enabled/disabled) and timestamp
  2. Health response includes confidence scores from ConfidenceController
  3. Health response includes primary and secondary WAN congestion states
  4. Health server starts automatically when steering daemon starts
  5. Health server stops automatically when steering daemon stops
**Plans**: TBD

Plans:
- [ ] 26-01: Add steering state fields to health response
- [ ] 26-02: Wire health server into steering daemon lifecycle

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 25. Health Endpoint Core | 0/2 | Planned | - |
| 26. Steering State & Integration | 0/2 | Not started | - |

## Coverage

All 14 v1.4 requirements mapped:

| Requirement | Phase | Description |
|-------------|-------|-------------|
| HLTH-01 | 25 | HTTP health endpoint on port 9102 |
| HLTH-02 | 25 | GET / and GET /health routes |
| HLTH-03 | 25 | JSON response with status, uptime, version |
| HLTH-04 | 25 | 200 OK / 503 Service Unavailable |
| HLTH-05 | 25 | Background thread (daemon=True) |
| HLTH-06 | 25 | Clean shutdown support |
| STEER-01 | 26 | Steering state (enabled/disabled) |
| STEER-02 | 26 | Confidence scores |
| STEER-03 | 26 | Primary WAN congestion state |
| STEER-04 | 26 | Secondary WAN congestion state |
| STEER-05 | 26 | Last decision timestamp |
| INTG-01 | 26 | Health server starts on daemon init |
| INTG-02 | 26 | Health server stops on daemon shutdown |
| INTG-03 | 26 | Health status reflects daemon state |

---
*Roadmap created: 2026-01-23*
