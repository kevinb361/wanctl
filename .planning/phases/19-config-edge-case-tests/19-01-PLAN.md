---
phase: 19-config-edge-case-tests
plan: 01
type: execute
---

<objective>
Add edge case tests for config validation: boundary lengths, Unicode attacks, and numeric boundaries.

Purpose: Ensure security validation catches all edge cases before production deployment.
Output: New test file with comprehensive edge case coverage, all tests passing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Key files:**
@src/wanctl/config_base.py - validate_identifier, validate_comment, validate_ping_host
@src/wanctl/config_validation_utils.py - validate_alpha, validate_bandwidth_order, etc.
@tests/test_config_base.py - existing validation tests
@tests/test_config_validation_utils.py - existing validation utils tests

**Gap analysis:**
Existing tests cover:
- Basic valid/invalid cases
- Over-limit lengths (65, 129, 260 chars)
- Common injection attacks

Missing edge cases:
1. **Boundary lengths** - exact limits not tested (64, 128, 256 chars)
2. **Unicode attacks** - homoglyphs, zero-width characters, RTL overrides
3. **Numeric boundaries** - exact min/max values, float special cases
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add boundary length edge case tests</name>
  <files>tests/test_config_edge_cases.py</files>
  <action>
Create new test file with boundary length tests:

1. **validate_identifier boundaries:**
   - 63 chars (under limit) - should pass
   - 64 chars (at limit) - should pass
   - Test with valid pattern at exact boundary

2. **validate_comment boundaries:**
   - 127 chars (under limit) - should pass
   - 128 chars (at limit) - should pass

3. **validate_ping_host boundaries:**
   - 255 chars (under limit) - should pass
   - 256 chars (at limit) - should pass
   - Use valid hostname pattern (a.b.c...) to reach length

Test class: TestBoundaryLengths
  </action>
  <verify>pytest tests/test_config_edge_cases.py::TestBoundaryLengths -v passes</verify>
  <done>All boundary length tests pass, including exact-at-limit cases</done>
</task>

<task type="auto">
  <name>Task 2: Add Unicode edge case tests</name>
  <files>tests/test_config_edge_cases.py</files>
  <action>
Add Unicode security tests to same file:

1. **Homograph attacks** (characters that look like ASCII but aren't):
   - Cyrillic 'а' (U+0430) vs ASCII 'a' (U+0061)
   - Cyrillic 'о' (U+043E) vs ASCII 'o' (U+006F)
   - Full-width 'Ａ' (U+FF21) vs ASCII 'A'
   - Should all be REJECTED

2. **Zero-width characters:**
   - Zero-width space (U+200B) embedded in valid identifier
   - Zero-width non-joiner (U+200C)
   - Zero-width joiner (U+200D)
   - Should all be REJECTED

3. **Directional overrides:**
   - Right-to-left override (U+202E)
   - Left-to-right override (U+202D)
   - Should all be REJECTED

4. **Other Unicode tricks:**
   - Combining characters that modify previous char
   - Non-breaking space (U+00A0)
   - Should all be REJECTED

Test class: TestUnicodeEdgeCases
  </action>
  <verify>pytest tests/test_config_edge_cases.py::TestUnicodeEdgeCases -v passes</verify>
  <done>All Unicode edge case tests pass, ensuring regex rejects lookalike characters</done>
</task>

<task type="auto">
  <name>Task 3: Add numeric boundary edge case tests</name>
  <files>tests/test_config_edge_cases.py</files>
  <action>
Add numeric boundary tests to same file:

1. **validate_alpha exact boundaries:**
   - Exactly 0.0 (min boundary) - should pass
   - Exactly 1.0 (max boundary) - should pass
   - One epsilon below 0.0 (-1e-10) - should fail
   - One epsilon above 1.0 (1.0 + 1e-10) - should fail
   - Negative zero (-0.0) - should pass (equals 0.0)

2. **validate_field min/max boundaries:**
   - Exact min_val - should pass
   - Exact max_val - should pass
   - One below min - should fail
   - One above max - should fail

3. **Float special values:**
   - Subnormal numbers (smallest positive float)
   - Very large floats near overflow

Test class: TestNumericBoundaries
  </action>
  <verify>pytest tests/test_config_edge_cases.py::TestNumericBoundaries -v passes</verify>
  <done>All numeric boundary tests pass, including exact boundary values</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pytest tests/test_config_edge_cases.py -v` - all new tests pass
- [ ] `make ci` - full test suite passes (618+ tests)
- [ ] No regressions in existing config tests
</verification>

<success_criteria>
- New test file created with 3 test classes
- All boundary length tests pass
- All Unicode edge case tests pass
- All numeric boundary tests pass
- Full test suite passes
- Phase 19 complete
</success_criteria>

<output>
After completion, create `.planning/phases/19-config-edge-case-tests/19-01-SUMMARY.md`
</output>
