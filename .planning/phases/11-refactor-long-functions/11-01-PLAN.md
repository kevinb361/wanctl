---
phase: 11-refactor-long-functions
plan: 01
type: execute
---

<objective>
Split Config._load_specific_fields() (151 lines) into focused helper methods following the Phase 8 pattern.

Purpose: Improve readability and testability of autorate configuration loading by extracting semantic groups into dedicated methods.
Output: Config class with 10-12 helper methods, each handling one configuration section.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior art - Phase 8 used identical pattern:
@.planning/phases/08-extract-common-helpers/08-03-SUMMARY.md

# Source file to refactor:
@src/wanctl/autorate_continuous.py

**Pattern from Phase 8:**
SteeringConfig._load_specific_fields() (129 lines) was split into 15 helper methods.
Apply same pattern to Config._load_specific_fields() (151 lines).

**Established patterns:**
- Helper methods prefixed with `_load_` (e.g., `_load_router_config()`)
- Each method handles one semantic section
- Main method becomes orchestration of helper calls
- No behavioral changes - pure structural refactoring
</context>

<tasks>

<task type="auto">
  <name>Task 1: Split Config._load_specific_fields() into helper methods</name>
  <files>src/wanctl/autorate_continuous.py</files>
  <action>
Extract _load_specific_fields() (lines 145-296) into focused helper methods:

1. `_load_queue_config()` - queues section (lines 147-153)
2. `_load_download_config()` - download parameters + validation (lines 160-189)
3. `_load_upload_config()` - upload parameters + validation (lines 191-217)
4. `_load_threshold_config()` - thresholds section (lines 219-239)
5. `_load_ping_config()` - ping hosts and median setting (lines 241-243)
6. `_load_fallback_config()` - fallback connectivity checks (lines 245-256)
7. `_load_timeout_config()` - timeout settings (lines 258-261)
8. `_load_router_transport_config()` - router transport settings (lines 263-269)
9. `_load_lock_and_state_config()` - lock file and state file paths (lines 271-278)
10. `_load_logging_config()` - logging paths (lines 280-282)
11. `_load_health_check_config()` - health check settings (lines 284-288)
12. `_load_metrics_config()` - metrics settings (lines 290-295)

Refactored _load_specific_fields() becomes:
```python
def _load_specific_fields(self) -> None:
    """Load autorate-specific configuration fields."""
    self._load_queue_config()
    cm = self.data['continuous_monitoring']
    self._load_download_config(cm)
    self._load_upload_config(cm)
    self._load_threshold_config(cm)
    self._load_ping_config(cm)
    self._load_fallback_config(cm)
    self._load_timeout_config()
    self._load_router_transport_config()
    self._load_lock_and_state_config()
    self._load_logging_config()
    self._load_health_check_config()
    self._load_metrics_config()
```

Each helper method sets the same instance variables as before - NO behavioral changes.
Preserve all validation calls (validate_bandwidth_order, validate_threshold_order).
Preserve all comments documenting architectural invariants.
  </action>
  <verify>python -c "from wanctl.autorate_continuous import Config; print('Import OK')"</verify>
  <done>Config._load_specific_fields() reduced to ~15 lines of orchestration, 12 helper methods created</done>
</task>

<task type="auto">
  <name>Task 2: Verify config loading unchanged</name>
  <files>src/wanctl/autorate_continuous.py</files>
  <action>
Run the full test suite to verify no behavioral changes:
1. Run `make ci` (includes type checking, linting, tests)
2. Verify all 474+ tests pass
3. Verify no new type errors or lint warnings

If any tests fail, investigate and fix before proceeding.
The refactoring must be purely structural - same instance variables, same validation, same behavior.
  </action>
  <verify>make ci</verify>
  <done>All tests pass, no type errors, no lint warnings, config loading behavior unchanged</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Config._load_specific_fields() reduced from 151 lines to ~15 lines
- [ ] 12 helper methods created with clear single responsibility
- [ ] `make ci` passes (all tests, type check, lint)
- [ ] No behavioral changes - same config fields populated
</verification>

<success_criteria>

- Config._load_specific_fields() is now orchestration-only (~15 lines)
- 12 focused helper methods handle individual config sections
- All 474+ tests pass
- No type errors or lint warnings
- Pattern matches Phase 8 SteeringConfig refactoring
</success_criteria>

<output>
After completion, create `.planning/phases/11-refactor-long-functions/11-01-SUMMARY.md`
</output>
