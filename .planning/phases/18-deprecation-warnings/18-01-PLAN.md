# Plan 18-01: Add Deprecation Warnings for Legacy Steering Params

## Objective

Add deprecation warnings when users configure legacy steering parameters, guiding them to use the new CAKE-aware parameter names instead.

## Legacy â†’ New Mapping

| Legacy Parameter | New Parameter | Context |
|-----------------|---------------|---------|
| `bad_samples` | `red_samples_required` | Samples to confirm degraded state |
| `good_samples` | `green_samples_required` | Samples to confirm recovery |

**Note:** `bad_threshold_ms` and `recovery_threshold_ms` are still valid for RTT-only mode (when `cake_aware: false`), so they should NOT be deprecated.

## Current Behavior

Both sets of parameters are loaded in `SteeringConfig._load_threshold_config()`:
- Legacy params used when `cake_aware: false`
- New params used when `cake_aware: true`

Both can coexist, but having both is confusing for users.

## Tasks

### Task 1: Add deprecation warning function

**File:** `src/wanctl/steering/daemon.py`

Add helper function after imports:
```python
def _warn_deprecated_param(
    config_dict: dict,
    old_name: str,
    new_name: str,
    logger: logging.Logger
) -> None:
    """Log deprecation warning if old parameter name is used."""
    if old_name in config_dict:
        logger.warning(
            f"[DEPRECATED] '{old_name}' is deprecated, use '{new_name}' instead. "
            f"'{old_name}' will be removed in a future version."
        )
```

### Task 2: Add warnings in config loading

**File:** `src/wanctl/steering/daemon.py`

In `_load_threshold_config()`, after loading thresholds dict (~line 273):

```python
# Deprecation warnings for legacy parameters
_warn_deprecated_param(thresholds, 'bad_samples', 'red_samples_required',
                       logging.getLogger(__name__))
_warn_deprecated_param(thresholds, 'good_samples', 'green_samples_required',
                       logging.getLogger(__name__))
```

### Task 3: Update CONFIG_SCHEMA.md

**File:** `docs/CONFIG_SCHEMA.md`

Add deprecation notices to the thresholds table:
- Mark `bad_samples` as deprecated with note about `red_samples_required`
- Mark `good_samples` as deprecated with note about `green_samples_required`

### Task 4: Add unit tests

**File:** `tests/test_steering_deprecation.py` (new)

Tests:
1. `test_bad_samples_logs_deprecation_warning` - Verify warning when bad_samples used
2. `test_good_samples_logs_deprecation_warning` - Verify warning when good_samples used
3. `test_new_params_no_warning` - Verify no warning when using new params only
4. `test_both_params_logs_warning` - Verify warning when both old and new used

## Verification

```bash
.venv/bin/python -m pytest tests/test_steering_deprecation.py -v
.venv/bin/python -m pytest tests/ -v  # Full suite
```

## Success Criteria

- Deprecation warning logged when legacy params used
- Warning includes old name, new name, and removal notice
- No warning when only new params used
- Documentation updated with deprecation notices
- Existing functionality unchanged

## Risk Assessment

**LOW risk:**
- Warnings only, no behavioral changes
- Backward compatibility preserved
- Legacy params still work as before

## Files Modified

1. `src/wanctl/steering/daemon.py` - Add deprecation warning logic
2. `docs/CONFIG_SCHEMA.md` - Add deprecation notices
3. `tests/test_steering_deprecation.py` - New test file
