---
phase: 10-utility-consolidation-part-2
plan: 01
type: execute
---

<objective>
Merge ping_utils.py into rtt_measurement.py to eliminate module fragmentation.

Purpose: Consolidate related ping/RTT parsing utilities into a single module, following the Phase 9 consolidation pattern.
Output: rtt_measurement.py containing all ping parsing logic, ping_utils.py deleted.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (dependency graph):
@.planning/phases/09-utility-consolidation-part-1/09-02-SUMMARY.md

# Source files being modified:
@src/wanctl/ping_utils.py
@src/wanctl/rtt_measurement.py
@src/wanctl/calibrate.py

**Established pattern from Phase 9:**
- Move all code from smaller module to larger related module
- Update all imports across codebase
- Delete the smaller module
- Verify tests pass
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move parse_ping_output() to rtt_measurement.py</name>
  <files>src/wanctl/rtt_measurement.py</files>
  <action>
  Move the parse_ping_output() function from ping_utils.py to rtt_measurement.py:
  1. Add the function near the top of the file (after imports, before classes)
  2. Include the full docstring with examples
  3. Add required imports (re, logging, List, Optional from typing)
  4. Update the existing import in rtt_measurement.py from `from .ping_utils import parse_ping_output` to use the local function
  5. Add parse_ping_output to module's public API

  Do NOT change any function logic - pure code movement.
  </action>
  <verify>python -c "from wanctl.rtt_measurement import parse_ping_output; print(parse_ping_output('time=12.3 ms'))"</verify>
  <done>parse_ping_output() exists in rtt_measurement.py and returns [12.3] for test input</done>
</task>

<task type="auto">
  <name>Task 2: Update imports in calibrate.py</name>
  <files>src/wanctl/calibrate.py</files>
  <action>
  Update the import statement in calibrate.py:
  - Change: `from wanctl.ping_utils import parse_ping_output`
  - To: `from wanctl.rtt_measurement import parse_ping_output`

  No other changes needed - function signature unchanged.
  </action>
  <verify>python -c "from wanctl.calibrate import main; print('import ok')"</verify>
  <done>calibrate.py imports parse_ping_output from rtt_measurement</done>
</task>

<task type="auto">
  <name>Task 3: Delete ping_utils.py and verify tests</name>
  <files>src/wanctl/ping_utils.py</files>
  <action>
  1. Delete src/wanctl/ping_utils.py (65 lines)
  2. Run full test suite to verify no breakage
  3. Confirm no remaining imports of ping_utils anywhere in codebase

  Use: grep -r "ping_utils" src/ tests/ to verify no stale imports remain.
  </action>
  <verify>make ci</verify>
  <done>ping_utils.py deleted, all 474 tests pass, no stale imports</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] parse_ping_output() exists in rtt_measurement.py with full docstring
- [ ] calibrate.py imports from rtt_measurement
- [ ] ping_utils.py deleted
- [ ] `grep -r "ping_utils" src/ tests/` returns no results
- [ ] `make ci` passes (all tests, lint, type check)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No imports of ping_utils remain
- ping_utils.py removed from codebase
- 65 lines of module fragmentation eliminated
</success_criteria>

<output>
After completion, create `.planning/phases/10-utility-consolidation-part-2/10-01-SUMMARY.md`
</output>
